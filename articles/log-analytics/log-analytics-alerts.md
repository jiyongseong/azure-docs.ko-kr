---
title: Azure Log Analytics의 경고 이해 | Microsoft Docs
description: Log Analytics의 경고는 OMS 저장소의 중요한 정보를 식별하며 문제를 미리 알리거나 작업을 호출하여 문제 해결을 시도합니다.  이 문서에서는 다양한 유형의 경고 규칙 및 경고 규칙을 정의하는 방법에 대해 설명합니다.
services: log-analytics
documentationcenter: ''
author: bwren
manager: carmonm
editor: tysonn
ms.assetid: 6cfd2a46-b6a2-4f79-a67b-08ce488f9a91
ms.service: log-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/13/2018
ms.author: bwren
ms.openlocfilehash: cf1842c6abbbfd767184d8f480a5f3a5fd654ed0
ms.sourcegitcommit: e2adef58c03b0a780173df2d988907b5cb809c82
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/28/2018
---
# <a name="understanding-alerts-in-log-analytics"></a>Log Analytics의 경고 이해

> [!NOTE]
> Log Analytics의 경고가 [Azure로 확장](../monitoring-and-diagnostics/monitoring-alerts-extend.md)되고 있습니다. 이 문서의 정보는 Log Analytics 검색을 사용하는 Azure Portal에서 경고의 세부 정보를 정의하는 데 계속 사용할 수 있습니다.

Log Analytics의 경고는 Log Analytics 리포지토리에서 중요한 정보를 식별합니다. 이 문서에서는 쿼리되는 데이터의 컬렉션 빈도, 네트워크 대기 시간 또는 처리 용량으로 인해 발생할 수 있는 데이터 수집 임의 지연, Log Analytics 작업 영역으로 데이터를 커밋하는 데 기반하여 결정을 내려야 하는 몇 가지 디자인에 대해 설명합니다. 또한 Log Analytics에서 경고 규칙이 작동하는 방법 및 다양한 종류의 경고 규칙 간의 차이점에 대해 자세히 설명합니다.

경고 규칙을 만드는 과정은 다음 문서를 참조하세요.

- [Azure Portal](log-analytics-alerts-creating.md)을 사용하여 경고 규칙 만들기
- [Resource Manager 템플릿](../operations-management-suite/operations-management-suite-solutions-resources-searches-alerts.md)을 사용하여 경고 규칙 만들기
- [REST API](log-analytics-api-alerts.md)를 사용하여 경고 규칙 만들기

## <a name="considerations"></a>고려 사항

다양한 솔루션 및 데이터 형식에 대한 데이터 컬렉션 빈도에 대한 세부 정보는 솔루션 개요 문서의 [데이터 컬렉션 세부 정보](log-analytics-add-solutions.md#data-collection-details)에서 제공됩니다. 이 문서에서 설명했듯이 컬렉션 빈도는 *알림*에 대해 7일에 한 번으로 설정될 수 있습니다. 경고를 설정하기 전에 데이터 컬렉션 빈도를 이해하고 고려해야 합니다. 

- 컬렉션 빈도는 컴퓨터의 OMS 에이전트가 Log Analytics에 데이터를 보내는 빈도를 결정합니다. 예를 들어, 컬렉션 빈도가 10분이고 시스템에 다른 지연이 발생하지 않는 경우 전송된 데이터의 타임스탬프는 리포지토리에 추가되기 0~10분 전으로 설정되며 Log Analytics에서 검색 가능합니다.

- 경고를 트리거하기 전에 쿼리할 때 사용할 수 있도록 데이터가 리포지토리에 작성되어야 합니다. 위에서 설명한 대기 시간 때문에 컬렉션 빈도는 데이터를 쿼리에 사용할 수 있는 시간과 동일하지 않습니다. 예를 들어 데이터를 10분마다 정확하게 수집할 수 있지만 데이터를 비정기적으로 데이터 리포지토리에서 사용할 수 있습니다. 가설적으로 0, 10, 20분 간격으로 수집된 데이터는 각각 25, 28, 35분 또는 수집 대기 시간의 영향을 받는 다른 비정상적인 간격으로 검색을 위해 사용할 수 있습니다. 이러한 지연에서 최악의 경우는 [Log Analytics에 대한 SLA](https://azure.microsoft.com/support/legal/sla/log-analytics/v1_1)에 설명되어 있습니다. 여기에는 컴퓨터와 Log Analytics 서비스 간의 컬렉션 빈도 또는 네트워크 대기 시간으로 인한 지연이 포함되지 않습니다.


## <a name="alert-rules"></a>경고 규칙

경고는 일정한 간격으로 로그 검색을 자동으로 실행하는 경고 규칙에 의해 만들어집니다. 로그 검색 결과가 특정 조건과 일치하는 경우 경고 레코드가 만들어집니다. 그런 다음 규칙에 따라 하나 이상의 작업이 자동으로 실행되어 경고를 미리 알리거나 다른 프로세스를 호출할 수 있습니다. 이 분석을 수행하기 위해 다양한 유형의 경고 규칙에서 별도의 논리를 사용합니다.

![Log Analytics rudrh](media/log-analytics-alerts/overview.png)

로그 데이터의 수집에서 예상되는 대기 시간이 있기 때문에 데이터 인덱싱과 검색에 사용할 수 있는 시기 간의 절대 시간을 예측할 수 없습니다. 경고 규칙을 정의하는 동안 수집된 데이터의 근실시간 가용성을 고려해야 합니다.

경고의 안정성과 경고의 응답성을 절충해야 합니다. 잘못된 경고 및 누락된 경고를 최소화하도록 경고 매개 변수를 구성할 수 있습니다. 또는 모니터링되는 조건에 따라 신속하게 응답하지만 경우에 따라 잘못된 경고나 누락된 경고를 생성하는 경고 매개 변수를 선택할 수 있습니다.

경고 규칙은 다음 세부 정보에 의해 정의됩니다.

- **로그 검색**. 경고 규칙이 실행될 때마다 실행되는 쿼리입니다. 이 쿼리에서 반환된 레코드는 경고를 생성할지 여부를 결정하는 데 사용됩니다.
- **기간**. 쿼리에 대한 시간 범위를 지정합니다. 쿼리에서는 현재 시간의 이 범위 내에서 생성된 레코드만 반환합니다. 이는 5분에서 24시간 사이의 임의 값일 수 있습니다. 범위는 수집에서 발생하는 적절한 지연을 충분히 수용해야 합니다. 시간 기간은 처리할 수 있는 가장 긴 지연 시간의 두 배여야 합니다.<br> 예를 들어, 30분 지연 동안 경고를 신뢰할 수 있으려면 범위가 1시간이여야 합니다.

    시간 범위가 너무 작은 경우 두 가지 증상이 발생할 수 있습니다.

    - **누락된 경고** 수집 지연 시간이 60분이라고 가정하지만 대부분의 경우 15분입니다. 시간 범위를 30분으로 설정한 경우 경고 쿼리가 실행될 때 데이터를 검색할 수 없기 때문에 지연이 60분이면 경고가 누락됩니다. 
   
        >[!NOTE]
        >경고를 누락한 이유를 진단할 수 없습니다. 예를 들어 위와 같은 경우 경고 쿼리가 실행되고 60분 후에 데이터를 리포지토리에 작성합니다. 경고가 누락된 다음 날에 알림을 받고 같은 날에 올바른 시간 간격으로 쿼리가 실행되는 경우 로그 검색 조건은 결과와 일치합니다. 경고가 트리거되었어야 한다고 표시할 수 있습니다. 사실, 경고 쿼리가 실행 될 때 데이터를 아직 사용할 수 없으므로 경고가 트리거되지 않았습니다. 
        >
 
    - **잘못된 경고** 경우에 따라 경고 쿼리는 이벤트가 없는 것을 식별하도록 디자인됩니다. 가상 머신이 오프라인일 때 누락된 하트비트를 검색하여 감지하는 것이 이러한 예입니다. 위와 같이 하트비트를 경고 시간 범위 내에 검색에 사용할 수 없는 경우 하트비트 데이터를 검색할 수 없고 따라서 데이터가 없기 때문에 경고가 생성됩니다. VM이 합법적인 방식으로 오프라인이고 여기에서 생성된 하트비트 데이터가 없는 경우와 동일한 결과가 발생합니다. 다음 날 올바른 시간 범위에 쿼리를 실행하면 하트비트가 있고 경고가 실패한 것이 표시됩니다. 사실, 경고 기간을 너무 짧게 설정했기 때문에 하트비트를 검색에 사용할 수 없습니다.

- **빈도**.  쿼리를 실행해야 하는 빈도를 지정하고 일반적인 경우에 응답하도록 경고를 만드는 데 사용할 수 있습니다. 값은 5분에서 24시간 사이일 수 있으며 경고 기간보다 짧거나 같아야 합니다.  값이 기간보다 큰 경우 레코드가 누락될 위험이 있습니다.<br>정상 지연 10분이지만 최대 30분 동안 안정시키는 것이 목표인 경우 기간이 1시간이고 빈도 값이 10분이어야 합니다. 경고 데이터를 생성하는 10~20분 사이의 10분 수집 지연 시간이 있는 데이터로 알림을 트리거할 수 있습니다.<br>기간이 너무 넓기 때문에 동일한 데이터에 대해 여러 개의 경고를 만들지 않도록 방지하려면 적어도 기간 동안 경고를 표시하지 않도록 [경고 표시 안 함] 옵션을 사용할 수 있습니다.
  
- **임계값**. 로그 검색 결과를 평가하여 경고를 만들어야 하는지 여부를 결정합니다. 임계값은 다양한 유형의 경고 규칙에 따라 다릅니다.

Log Analytics의 각 경고 규칙은 두 가지 형식 중 하나입니다. 이러한 각 유형에 대해서는 다음 섹션에서 자세히 설명합니다.

- **[결과 수](#number-of-results-alert-rules)** - 로그 검색에서 반환되는 레코드 수가 지정된 수를 초과할 때 만들어지는 단일 경고입니다.
- **[미터법](#metric-measurement-alert-rules)** - 로그 검색 결과에서 지정된 임계값을 초과하는 값을 포함한 각 개체에 대해 만들어지는 경고입니다.

경고 규칙 유형 간의 차이점은 다음과 같습니다.

- **결과 수** 경고 규칙은 항상 단일 경고를 만드는 반면, **미터법** 경고 규칙은 임계값을 초과하는 각 개체에 대해 경고를 만듭니다.
- **결과 수** 경고 규칙은 임계값을 한 번 초과하면 경고를 만듭니다. **미터법** 경고 규칙은 특정 시간 간격 동안 임계값이 특정 횟수를 초과하면 경고를 만들 수 있습니다.

## <a name="number-of-results-alert-rules"></a>결과 수 경고 규칙
**결과 수** 경고 규칙은 검색 쿼리에서 반환된 레코드 수가 지정된 임계값을 초과하면 단일 경고를 만듭니다.

### <a name="threshold"></a>임계값
**결과 수** 경고 규칙의 임계값은 특정 값보다 크거나 작습니다. 로그 검색에서 반환된 레코드 수가 이 조건과 일치하면 경고를 만듭니다.

### <a name="scenarios"></a>시나리오

#### <a name="events"></a>이벤트
이 형식의 경고 규칙은 Windows 이벤트 로그, Syslog 및 사용자 지정 로그와 같은 이벤트 작업에 적합합니다. 특정 오류 이벤트가 생성될 때 또는 특정 기간 내에 복수의 오류 이벤트가 생성되는 경우 경고를 만드는 것이 좋습니다.

단일 이벤트에 대해 경고하려면 결과 수를 0보다 큰 수로 설정하고 빈도와 기간을 모두 5 분으로 설정합니다. 그러면 5분마다 쿼리를 실행하고 마지막 쿼리 실행 이후 생성된 단일 이벤트 발생을 확인합니다. 빈도가 더 길면 수집 중인 이벤트와 생성 중인 경고 사이의 시간이 지연될 수 있습니다.

일부 응용 프로그램은 경고를 발생시키지 않아야 할 가끔씩 발생하는 오류를 기록할 수 있습니다. 예를 들어 응용 프로그램이 오류 이벤트를 생성한 프로세스를 재시도한 후 다음에 성공할 수 있습니다. 이 경우 특정 기간 내에 복수의 이벤트가 생성되지 않은 한 경고를 만들지 않는 것이 좋습니다.

경우에 따라 이벤트가 없을 때 경고를 만드는 것이 좋습니다. 예를 들어 프로세스에서 일반 이벤트가 올바르게 작동 중임을 나타내기 위해 일반 이벤트를 기록할 수 있습니다. 특정 기간 내에 이러한 이벤트 중 하나가 기록되지 않으면 경고를 만들어야 합니다. 이 경우 임계값을 **1보다 작게** 설정할 수 있습니다.

#### <a name="performance-alerts"></a>성능 경고
[성능 데이터](log-analytics-data-sources-performance-counters.md) 는 이벤트와 유사한 레코드로 OMS 저장소에 저장됩니다. 성능 카운터가 특정 임계값을 초과하는 경우 경고하도록 하려면 해당 임계값을 쿼리에 포함시켜야 합니다.

예를 들어 프로세서가 90%를 초과하여 실행되는 경우 경고하려면 다음과 같은 쿼리를 사용하고 경고 규칙에 대한 임계값을 **0보다 크게** 설정합니다.

    Perf | where ObjectName=="Processor" and CounterName=="% Processor Time" and CounterValue>90

특정 기간에 프로세서 평균 사용량이 90%를 초과하는 경우에 경고하려면 다음과 같은 `measure` 명령을 사용하여 쿼리하고 경고 규칙에 대한 임계값을 **0보다 크게** 설정합니다.

    Perf | where ObjectName=="Processor" and CounterName=="% Processor Time" | summarize avg(CounterValue) by Computer | where CounterValue>90



## <a name="metric-measurement-alert-rules"></a>미터법 경고 규칙

>[!NOTE]
> 미터법 경고 규칙은 현재 공개 미리 보기 상태입니다.

**미터법** 경고 규칙은 쿼리에서 지정된 임계값을 초과하는 값을 포함한 각 개체에 대해 경고를 만듭니다. **결과 수** 경고 규칙과는 다음과 같이 분명하게 구별됩니다.

#### <a name="log-search"></a>로그 검색
**결과 수** 경고 규칙에 대해서는 모든 쿼리를 사용할 수 있지만, 미터법 경고 규칙에 대한 쿼리에는 특정 요구 사항이 있습니다.  특정 필드를 기준으로 결과를 그룹화하려면 `measure` 명령을 포함해야 합니다. 이 명령에는 다음 요소가 포함되어야 합니다.


- **집계 함수** -  수행되는 계산과 잠재적으로 집계할 숫자 필드를 결정합니다. 예를 들어 **count()** 는 쿼리의 레코드 수를 반환하고, **avg(CounterValue)** 는 해당 간격 동안 CounterValue 필드의 평균을 반환합니다.
- **그룹 필드** -  이 필드의 각 인스턴스에 대해 집계된 값이 있는 레코드가 만들어지며 각각에 대해 경고가 생성될 수 있습니다. 예를 들어 각 컴퓨터에 대해 경고를 생성하려면 **컴퓨터별**을 사용합니다.   
- **간격**.  데이터가 집계되는 시간 간격을 정의합니다.  예를 들어 **5분**을 지정한 경우 경고에 대해 지정한 기간 동안 5분 간격으로 집계된 그룹 필드의 각 인스턴스에 대한 레코드가 만들어집니다.

#### <a name="threshold"></a>임계값
미터법 경고 규칙의 임계값은 집계 값 및 위반 횟수로 정의됩니다. 로그 검색에서 데이터 요소가 이 값을 초과하면 위반으로 간주됩니다. 결과의 개체에서 위반 횟수가 지정된 값을 초과하면 해당 개체에 대한 경고가 만들어집니다.

#### <a name="example"></a>예
컴퓨터에서 30분 동안 90% 프로세서 사용률을 3회 초과하는 경우 경고가 필요한 시나리오를 고려해 보세요. 다음 세부 정보로 경고 규칙을 만들 수 있습니다.

**쿼리:** Type=Perf ObjectName=Processor CounterName="% Processor Time" | measure avg(CounterValue) by Computer Interval 5minute<br>
**기간:** 30분<br>
**경고 빈도:** 5분<br>
**집계 값:** 90 초과<br>
**경고 트리거 조건:** 총 위반 5 초과<br>

이 쿼리는 각 컴퓨터에 대해 5분 간격으로 평균 값을 만듭니다. 이 쿼리는 이전 30분 동안 수집된 데이터에 대해 5분마다 실행됩니다. 세 개의 컴퓨터에 대한 샘플 데이터는 다음과 같습니다.

![샘플 쿼리 결과](media/log-analytics-alerts/metrics-measurement-sample-graph.png)

이 예제에서 srv02와 srv03은 기간 동안 90% 임계값을 3회 위반했기 때문에 별도의 경고가 만들어집니다. **경고 트리거 조건**이 **연속**으로 변경된 경우 세 개의 연속 샘플에 대한 임계값을 위반했기 때문에 srv03에 대해서만 경고가 만들어집니다.

## <a name="alert-records"></a>경고 레코드
Log Analytics의 규칙에 의해 만든 경고 레코드에는 **경고**의 **유형** 및 **OMS**의 **SourceSystem**이 있습니다. 이들은 다음 표의 속성을 가집니다.

| 자산 | 설명 |
|:--- |:--- |
| type |*경고* |
| SourceSystem |*OMS* |
| *Object*  | [미터법 경고](#metric-measurement-alert-rules)에는 그룹 필드 속성이 있습니다. 예를 들어 로그 검색에서 Computer 기준으로 그룹화하는 경우 경고 레코드에는 값으로 컴퓨터 이름을 포함한 Computer 필드가 있습니다.
| AlertName |경고의 이름입니다. |
| AlertSeverity |경고의 심각도 수준입니다. |
| LinkToSearchResults |경고를 생성한 쿼리에서 레코드를 반환하는 Log Analytics 로그 검색에 대한 링크입니다. |
| 쿼리 |실행된 쿼리의 텍스트입니다. |
| QueryExecutionEndTime |쿼리에 대한 시간 범위의 끝입니다. |
| QueryExecutionStartTime |쿼리에 대한 시간 범위의 시작입니다. |
| ThresholdOperator | 경고 규칙에서 사용하는 연산자입니다. |
| ThresholdValue | 경고 규칙에서 사용하는 값입니다. |
| TimeGenerated |경고가 만들어진 날짜 및 시간입니다. |

[경고 관리 솔루션](log-analytics-solution-alert-management.md) 및 [Power BI 내보내기](log-analytics-powerbi.md)에 의해 만들어진 다른 종류의 경고 레코드가 있습니다.  이들은 모두 **경고**의 **유형**을 갖지만 해당 **SourceSystem**에 의해 구별됩니다.


## <a name="next-steps"></a>다음 단계
* [경고 관리 솔루션](log-analytics-solution-alert-management.md)을 설치하여 System Center Operations Manager에서 수집한 경고와 함께 Log Analytics에서 만든 경고를 분석합니다.
* 경고를 생성할 수 있는 [로그 검색](log-analytics-log-searches.md) 에 대해 자세한 내용을 읽습니다.
* 경고 규칙을 사용하여 [웹후크를 구성](log-analytics-alerts-webhooks.md) 하는 연습을 완료합니다.
* 경고에 의해 식별된 문제를 수정하는 [Azure Automation의 Runbook](https://azure.microsoft.com/documentation/services/automation) 을 작성하는 방법에 대해 알아봅니다.
