---
title: "Azure 스택 VPN을 사용 하 여 Azure에 연결"
description: "Azure 스택에서 가상 네트워크 VPN을 사용 하 여 Azure에서 가상 네트워크에 연결 하는 방법."
services: azure-stack
documentationcenter: 
author: brenduns
manager: femila
editor: 
ms.assetid: 
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 9/25/2017
ms.author: brenduns
ms.reviewer: scottnap
ms.openlocfilehash: 16cc1962eb72ac219adc8483f38cecf41a4296c1
ms.sourcegitcommit: d87b039e13a5f8df1ee9d82a727e6bc04715c341
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 02/21/2018
---
# <a name="connect-azure-stack-to-azure-using-vpn"></a>Azure 스택 VPN을 사용 하 여 Azure에 연결

*적용 대상: Azure 스택 시스템 통합*

이 문서는 스택에서 Azure 가상 네트워크를 Azure의 가상 네트워크에 연결할 사이트 간 VPN을 만드는 방법을 보여 줍니다.

### <a name="connection-diagram"></a>연결 다이어그램
다음 다이어그램을 보여 줍니다 연결 구성 해야 완료 되 면:

![사이트 간 VPN 연결 구성](media/azure-stack-connect-vpn/image2.png)

### <a name="before-you-begin"></a>시작하기 전에
연결 구성을 완료 하려면를 시작 하기 전에 다음 항목이 있는지 확인 하십시오.

* Azure 스택 직접 인터넷에 연결 된 시스템 (다중 노드) 배포를 통합 합니다. 즉, 외부 공용 IP 주소 범위는 공용 인터넷에서 직접 연결할 수 여야 합니다.
* 유효한 Azure 구독입니다.  Azure 구독이 없는 경우 만들 수 있습니다는 [여기에서 Azure 계정이 있음](https://azure.microsoft.com/free/?b=17.06)합니다.

## <a name="network-example-values-table"></a>네트워크 예에서는 값 테이블
네트워크 예제 값 표는이 문서에 사용 되는 샘플 값을 보여줍니다. 이러한 값을 사용할 수 또는이 문서의 예제를 보다 잘 이해 하기 위해 참조할 수 있습니다.

네트워크 예에서는 값 테이블
|   |Azure Stack|Azure|
|---------|---------|---------|
|가상 네트워크 이름     |Azs-VNet|AzureVNet |
|가상 네트워크 주소 공간 |10.1.0.0/16|10.100.0.0/16|
|서브넷 이름     |FrontEnd|FrontEnd|
|서브넷 주소 범위|10.1.0.0/24 |10.100.0.0/24 |
|게이트웨이 서브넷      |10.1.1.0/24|10.100.1.0/24|

## <a name="create-the-network-resources-in-azure"></a>Azure에서 네트워크 리소스 만들기

먼저 Azure에 대 한 네트워크 리소스를 만듭니다. 다음 지침을 사용 하 여 리소스를 만드는 방법을 보여는 [Azure 포털](http://portal.azure.com/)합니다.

### <a name="create-the-virtual-network-and-vm-subnet"></a>가상 네트워크 및 VM 서브넷 만들기

1. 에 로그인 하는 [Azure 포털](http://portal.azure.com/) Azure 계정을 사용 합니다.
2. 사용자 포털에서 선택 **새로**합니다.
3. 로 이동 **마켓플레이스**를 선택한 후 **네트워킹**합니다.
4. **가상 네트워크**를 선택합니다.
5. 네트워크 구성 테이블에서 정보를 사용 하 여 Azure에 대 한 값을 확인 하려면 **이름**, **주소 공간**, **서브넷 이름**, 및 **서브넷 주소 범위**합니다.
6. 에 대 한 **리소스 그룹**, 새 리소스 그룹을 만들거나 이미 있는 경우 하나를 선택 **기존 항목 사용**합니다.
7. 선택 된 **위치** VNet의 합니다.  예제 값을 사용 하는 경우 선택 **미국 동부** 하거나 원하는 경우 다른 위치를 사용 합니다.
8. **대시보드에 고정**을 선택합니다.
9. **만들기**를 선택합니다.

### <a name="create-the-gateway-subnet"></a>게이트웨이 서브넷 만들기
1. 만든 가상 네트워크 리소스를 엽니다 (**AzureVNet**) 대시보드에서.
2. 에 **설정** 섹션에서 **서브넷**합니다.
3. 선택 **게이트웨이 서브넷** 를 가상 네트워크에 게이트웨이 서브넷을 추가 합니다.
4. 서브넷의 이름은 **GatewaySubnet**이라고 기본으로 설정됩니다.
   게이트웨이 서브넷은 특별하며 제대로 작동하려면 특정 이름이 있어야 합니다.
5. 에 **주소 범위** 필드에서 주소 확인 **10.100.1.0/24**합니다.
6. 선택 **확인** 게이트웨이 서브넷을 만들려고 합니다.

### <a name="create-the-virtual-network-gateway"></a>가상 네트워크 게이트웨이 만들기
1. Azure 포털에서 선택 **새로**합니다.  
2. 로 이동 **마켓플레이스**를 선택한 후 **네트워킹**합니다.
3. 네트워크 리소스의 목록에서 선택 **가상 네트워크 게이트웨이**합니다.
4. **이름**, 형식 **Azure GW**합니다.
5. 가상 네트워크를 선택 하려면 선택 **가상 네트워크**합니다. 그런 다음 선택 **AzureVnet** 목록에서 합니다.
6. 선택 **공용 IP 주소**합니다. 경우는 **공용 IP 주소 선택** 섹션 열리고 **새로 만들기**합니다.
7. **이름**, 형식 **Azure-GW-PiP**를 선택한 후 **확인**합니다.
8. 기본적으로에 대 한 **VPN 유형을**, **경로 기반** 을 선택 합니다.
    유지 된 **경로 기반** VPN 유형입니다.
9. **구독** 및 **위치**가 올바른지 확인합니다. 리소스를 대시보드에 고정할 수 있습니다. **만들기**를 선택합니다.

### <a name="create-the-local-network-gateway-resource"></a>로컬 네트워크 게이트웨이 리소스 만들기

1. Azure 포털에서 선택 **새로**합니다. 
4. 로 이동 **마켓플레이스**를 선택한 후 **네트워킹**합니다.
5. 리소스 목록에서 선택 **로컬 네트워크 게이트웨이**합니다.
6. **이름**, 형식 **Azs GW**합니다.
7. **IP 주소**, 프로그램 Azure 스택 가상 네트워크 게이트웨이에 대 한 네트워크 구성 테이블의 앞부분에 나열 된 공용 IP 주소를 입력 합니다.
8. **주소 공간**, Azure 스택에서 입력는 **10.1.0.0/24** 및 **10.1.1.0/24** 주소 공간에 대 한 **AzureVNet**합니다.
9. 되어 있는지 확인 프로그램 **구독**, **리소스 그룹**, 및 **위치** 한 다음 선택 **만들기**합니다.

## <a name="create-the-connection"></a>연결 만들기
1. 사용자 포털에서 선택 **새로**합니다. 
2. 로 이동 **마켓플레이스**를 선택한 후 **네트워킹**합니다.
3. 리소스 목록에서 선택 **연결**합니다.
4. 에 **기본** 설정 섹션에 대 한는 **연결 유형**, 선택 **사이트 (IPSec)**합니다.
5. 선택 된 **구독**, **리소스 그룹**, 및 **위치**를 선택한 후 **확인**합니다.
6. 에 **설정** 섹션에서 **가상 네트워크 게이트웨이**를 선택한 후 **Azure GW**합니다.
7. 선택 **로컬 네트워크 게이트웨이**를 선택한 후 **Azs GW**합니다.
8. **연결 이름**, 형식 **Azure Azs**합니다.
9. **공유 키 (PSK)**, 형식 **12345**합니다. 다른 값을 선택 하면 해당 it 기억 *해야* 연결의 반대쪽 끝에서 만든 공유 키에 대 한 값과 일치 합니다. **확인**을 선택합니다.
10. 검토는 **요약** 섹션을 선택한 후 **확인**합니다.

## <a name="create-a-virtual-machine"></a>가상 머신 만들기
이제 Azure에서 가상 컴퓨터 만들기 및 가상 네트워크에 VM 서브넷에 배치 합니다.

1. Azure 포털에서 선택 **새로**합니다.
2. 로 이동 **마켓플레이스**를 선택한 후 **계산**합니다.
3. 가상 컴퓨터 이미지의 목록에서 선택 된 **Windows Server 2016 데이터 센터 Eval** 이미지입니다.
4. 에 **기본 사항** 섹션에 대 한 **이름**, 형식 **AzureVM**합니다.
5. 유효한 사용자 이름과 암호를 입력 합니다. 만든 후 가상 컴퓨터에 로그인 하려면이 계정을 사용 합니다.
6. 제공 된 **구독**, **리소스 그룹**, 및 **위치**, 선택한 후 **확인**합니다.
7. 에 **크기** 섹션에서이 인스턴스에 대 한 가상 컴퓨터 크기를 선택한 다음 선택 **선택**합니다.
8. 에 **설정을** 섹션에서 기본값을 사용할 수 있습니다. 다음 사항을 확인는 **AzureVnet** 가상 네트워크를 선택한 서브넷으로 설정 되어 있는지 확인 하십시오. **10.100.0.0/24**합니다. **확인**을 선택합니다.
9. 설정을 검토는 **요약** 섹션을 선택한 후 **확인**합니다.

## <a name="create-the-network-resources-in-azure-stack"></a>Azure 스택 네트워크 리소스를 만듭니다
이제 Azure 스택의 네트워크 리소스를 만듭니다.

### <a name="sign-in-as-a-user"></a>사용자로 로그인
서비스 관리자는 테스트 계획, 혜택 및 사용자가 사용할 수 있는 구독에 사용자로 로그인 수 있습니다. 하나를 모를 경우 [사용자 계정 만들기](azure-stack-add-new-user-aad.md) 에 로그인 합니다.

### <a name="create-the-virtual-network-and-vm-subnet"></a>가상 네트워크 및 VM 서브넷 만들기
1. 사용자 포털에 로그인 하려면 사용자 계정을 사용 합니다.
2. 사용자 포털에서 선택 **새로**합니다.

    ![새 가상 네트워크 만들기](media/azure-stack-create-vpn-connection-one-node-tp2/image3.png)

3. 로 이동 **마켓플레이스**를 선택한 후 **네트워킹**합니다.
4. **가상 네트워크**를 선택합니다.
5. 에 대 한 **이름**, **주소 공간**, **서브넷 이름**, 및 **서브넷 주소 범위**, 네트워크 구성 테이블에서 값을 사용 합니다.
6. **구독**, 이전에 만든 구독 나타납니다.
7. 에 대 한 **리소스 그룹**, 리소스 그룹을 만들 하거나 이미 있는 경우 하나를 선택 **기존 항목 사용**합니다.
8. 기본 위치를 확인합니다.
9. **대시보드에 고정**을 선택합니다.
10. **만들기**를 선택합니다.

### <a name="create-the-gateway-subnet"></a>게이트웨이 서브넷 만들기
1. 대시보드를 만든 Azs VNet 가상 네트워크 리소스를 엽니다.
2. 에 **설정** 섹션에서 **서브넷**합니다.
3. 게이트웨이 서브넷에 가상 네트워크를 추가 하려면 선택 **게이트웨이 서브넷**합니다.
   
    ![게이트웨이 서브넷 추가](media/azure-stack-create-vpn-connection-one-node-tp2/image4.png)

4. 기본적으로 서브넷 이름 설정 **GatewaySubnet**합니다.
   게이트웨이 서브넷은 특별 합니다. 사용 해야 올바르게 작동 하려면는 *GatewaySubnet* 이름입니다.
5. **주소 범위**, 주소 인지 확인 **10.1.1.0/24**합니다.
6. 선택 **확인** 게이트웨이 서브넷을 만들려고 합니다.

### <a name="create-the-virtual-network-gateway"></a>가상 네트워크 게이트웨이 만들기
1. Azure 스택 포털에서 선택 **새로**합니다. 
2. 로 이동 **마켓플레이스**를 선택한 후 **네트워킹**합니다.
3. 네트워크 리소스의 목록에서 선택 **가상 네트워크 게이트웨이**합니다.
4. **이름**, 형식 **Azs GW**합니다.
5. 선택 된 **가상 네트워크** 항목 가상 네트워크를 선택 합니다.
   선택 **Azs VNet** 목록에서 합니다.
6. 선택 된 **공용 IP 주소** 메뉴 항목입니다. 경우는 **공용 IP 주소 선택** 섹션 열리고 **새로 만들기**합니다.
7. **이름**, 형식 **Azs-GW-PiP**를 선택한 후 **확인**합니다.
8.  기본적으로에 대 한 **VPN 유형을**, **경로 기반** 을 선택 합니다.
    유지 된 **경로 기반** VPN 유형입니다.
9. **구독** 및 **위치**가 올바른지 확인합니다. 리소스를 대시보드에 고정할 수 있습니다. **만들기**를 선택합니다.

### <a name="create-the-local-network-gateway"></a>로컬 네트워크 게이트웨이 만들기
개념을 *로컬 네트워크 게이트웨이* Azure 스택은 Azure 배포 보다 조금 다릅니다.

Azure 배포에서 로컬 네트워크 게이트웨이 Azure에서 가상 네트워크 게이트웨이에 연결 하는 데 사용 하는 온-프레미스 (사용자 위치)에 물리적 장치를 나타냅니다. Azure 스택 연결의 양쪽 끝에는 가상 네트워크 게이트웨이 됩니다!

보다 일반적으로이 대해 생각 하는 방법은 로컬 네트워크 게이트웨이 리소스에 항상 연결의 다른 쪽 끝에서 원격 게이트웨이 나타냅니다 것입니다. 

### <a name="create-the-local-network-gateway-resource"></a>로컬 네트워크 게이트웨이 리소스 만들기
1. Azure 스택 포털에 로그인 합니다.
2. 사용자 포털에서 선택 **새로**합니다.
3. 로 이동 **마켓플레이스**를 선택한 후 **네트워킹**합니다.
4. 리소스 목록에서 선택 **로컬 네트워크 게이트웨이**합니다.
5. **이름**, 형식 **Azure GW**합니다.
6. **IP 주소**, Azure에서 가상 네트워크 게이트웨이에 대 한 공용 IP 주소를 입력 **Azure-GW-PiP**합니다. 이 주소는 네트워크 구성 테이블의 앞부분에 나오는 나타납니다.
7. **주소 공간**, 만든 Azure VNET에서 주소 공간에 대 한 입력 **10.100.0.0/24** 및 **10.100.1.0/24**합니다.
8. 되어 있는지 확인 프로그램 **구독**, **리소스 그룹**, 및 **위치** 한 다음 선택 **만들기**합니다.

### <a name="create-the-connection"></a>연결 만들기
1. 사용자 포털에서 선택 **새로**합니다.
2. 로 이동 **마켓플레이스**를 선택한 후 **네트워킹**합니다.
3. 리소스 목록에서 선택 **연결**합니다.
4. 에 **기본 사항** 설정 섹션에 대 한는 **연결 유형**선택, **사이트 (IPSec)**합니다.
5. 선택 된 **구독**, **리소스 그룹**, 및 **위치**를 선택한 후 **확인**합니다.
6. 에 **설정** 섹션에서 **가상 네트워크 게이트웨이**를 선택한 후 **Azs GW**합니다.
7. 선택 **로컬 네트워크 게이트웨이**를 선택한 후 **Azure GW**합니다.
8. **연결 이름**, 형식 **Azs Azure**합니다.
9. **공유 키 (PSK)**, 형식 **12345**를 선택한 후 **확인**합니다.
10. 에 **요약** 섹션에서 **확인**합니다.

### <a name="create-a-vm"></a>VM 만들기
VPN 연결을 통해 전송 되는 데이터의 유효성을 검사할 VPN 터널을 통해 데이터를 받거나 보내기 위해 양 끝에 가상 컴퓨터를 만드는 데 필요 합니다. 

1. Azure 포털에서 선택 **새로**합니다.
2. 로 이동 **마켓플레이스**를 선택한 후 **계산**합니다.
3. 가상 컴퓨터 이미지의 목록에서 선택 된 **Windows Server 2016 데이터 센터 Eval** 이미지입니다.
4. 에 **기본 사항** 섹션의 **이름**, 형식 **Azs VM**합니다.
5. 유효한 사용자 이름과 암호를 입력 합니다. 만든 후 VM에 로그인 하려면이 계정을 사용 합니다.
6. 제공 된 **구독**, **리소스 그룹**, 및 **위치**, 선택한 후 **확인**합니다.
7. 에 **크기** 가상 컴퓨터 크기를 선택이 인스턴스에 대 한 섹션을 선택한 후 **선택**합니다.
8. 에 **설정** 섹션에서 기본값을 사용 합니다. 다음 사항을 확인는 **Azs VNet** 가상 네트워크를 선택 합니다. 서브넷으로 설정 되어 있는지 확인 하십시오. **10.1.0.0/24**합니다. 그런 다음 **확인**을 선택합니다.
9. 에 **요약** 섹션에서 설정을 검토 한 다음 선택 **확인**합니다.


## <a name="test-the-connection"></a>연결 테스트
사이트 간 연결이 설정 되 했으므로 트래픽 흐름이 진행 되므로 얻을 수 있는지를 확인 해야 합니다. 확인을 위해 Azure 스택에서 만든 가상 컴퓨터 중 하나에 로그인 합니다. 그런 다음 Azure에서 만든 가상 컴퓨터를 ping 합니다. 

사이트 간 연결을 통해 트래픽을 보내는 하려면 VIP 하지 원격 서브넷에 가상 컴퓨터의 직접 IP (DIP) 주소를 ping 합니다. 이 작업을 수행 하려면 연결의 반대쪽 끝에서 DIP 주소가 찾습니다. 나중에 사용할 주소를 저장 합니다.

### <a name="sign-in-to-the-user-vm-in-azure-stack"></a>사용자 스택 Azure에서에서 VM에 로그인
1. Azure 스택 포털에 로그인 합니다.
2. 왼쪽된 탐색 모음에서 선택 **가상 컴퓨터**합니다.
3. Vm의 목록에서 찾을 **Azs VM** 는 이전에 만든 하 고 선택 합니다.
4. 가상 컴퓨터에 대 한 섹션을 클릭 하 여 **연결**, Azs VM.rdp 파일을 엽니다.
   
     ![연결 단추](media/azure-stack-create-vpn-connection-one-node-tp2/image17.png)
5. 가상 컴퓨터를 만들 때 구성한 계정으로 로그인 합니다.
6. 관리자 권한 열고 **Windows PowerShell** 창.
7. **ipconfig /all**을 입력합니다.
8. 출력에서 찾을 **IPv4 주소**, 나중에 사용할 주소를 저장 합니다. 이 주소가 Azure에서 ping 합니다. 예제 환경에서의 주소는 **10.1.0.4**, 하지만 사용자 환경에서 다른 수 있습니다. 내에서 속해 있어야 합니다.는 **10.1.0.0/24** 이전에 만든 서브넷입니다.
9. 가상 컴퓨터를 ping 응답을 허용 하는 방화벽 규칙을 만들려면 다음 PowerShell 명령을 실행 합니다.

   ```powershell
   New-NetFirewallRule `
    –DisplayName “Allow ICMPv4-In” `
    –Protocol ICMPv4
   ```

### <a name="sign-in-to-the-tenant-vm-in-azure"></a>테 넌 트 Azure에서 VM에 로그인
1. Azure 포털에 로그인합니다.
2. 왼쪽된 탐색 모음에서 **가상 컴퓨터**합니다.
3. 가상 컴퓨터의 목록에서 찾을 **Azure VM** 는 이전에 만든 하 고 선택 합니다.
4. 가상 컴퓨터에 대 한 섹션을 클릭 하 여 **연결**합니다.
5. 가상 컴퓨터를 만들 때 구성한 계정으로 로그인 합니다.
6. 관리자 권한 열고 **Windows PowerShell** 창.
7. **ipconfig /all**을 입력합니다.
8. 내에 포함 되는 IPv4 주소 표시 되어야 **10.100.0.0/24**합니다. 예제 환경에서의 주소는 **10.100.0.4**, 하지만 사용자의 주소는 다를 수 있습니다.
9. 가상 컴퓨터를 ping 응답을 허용 하는 방화벽 규칙을 만들려면 다음 PowerShell 명령을 실행 합니다.

   ```powershell
   New-NetFirewallRule `
    –DisplayName “Allow ICMPv4-In” `
    –Protocol ICMPv4
   ```

10. Azure에서 가상 컴퓨터에서 Azure 스택의 터널을 통해 가상 컴퓨터를 ping 합니다. 이 위해 Azs VM에서 기록한 DIP를 ping 합니다.
   이 예에서는 환경에서 **10.1.0.4**, 있지만 랩에서 기록해둔 주소를 ping 해야 합니다. 다음 스크린 샷에서 같은 결과가 나타납니다.
   
    ![성공적인 ping](media/azure-stack-create-vpn-connection-one-node-tp2/image19b.png)
11. 원격 가상 컴퓨터의 회신을 성공적으로 수행한 테스트를 나타냅니다! 가상 컴퓨터 창을 닫을 수 있습니다. 연결을 테스트 하려면 다른 종류의 파일 복사를 같은 데이터 전송을 시도할 수 있습니다.

### <a name="viewing-data-transfer-statistics-through-the-gateway-connection"></a>게이트웨이 연결을 통한 데이터 전송 통계 보기
사이트 간 연결을 통해 전달 데이터의 양을 확인 하려는 경우이 정보는에서 사용할 수는 **연결** 섹션. 이 테스트 방금 전송 받은 ping이 VPN 연결을 통해가 실제로 확인 하는 다른 방법은 이기도 합니다.

1. Azure 스택의 사용자 가상 컴퓨터에 로그인 되어 있는 동안 사용자 포털에 로그인 하려면 사용자 계정을 사용 합니다.
2. 로 이동 **모든 리소스**를 선택한 후는 **Azs Azure** 연결 합니다. **연결** 나타납니다.
4. 에 **연결** 섹션에 대 한 통계 **데이터에** 및 **데이터 출력** 나타납니다. 다음 스크린샷에 추가 파일 전송 되는 많은 되는 특성이 합니다. 일부 0이 아닌 값이 있는 표시 되어야 합니다.
   
    ![들어오는/나가는 데이터](media/azure-stack-connect-vpn/Connection.png)

## <a name="next-steps"></a>다음 단계

[Azure 및 Azure에 앱 배포 스택](azure-stack-solution-pipeline.md)
