---
title: 롤링 응용 프로그램 업그레이드 - Azure SQL Database | Microsoft Docs
description: Azure SQL Database 지역에서 복제를 사용하여 클라우드 응용 프로그램의 온라인 업그레이드를 지원하는 방법을 알아봅니다.
services: sql-database
author: anosov1960
manager: craigg
ms.service: sql-database
ms.custom: business continuity
ms.topic: article
ms.date: 04/01/2018
ms.author: sashan
ms.openlocfilehash: d1799befb2b5f59f1794bbca2a1daa2a13990882
ms.sourcegitcommit: 3a4ebcb58192f5bf7969482393090cb356294399
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/06/2018
---
# <a name="managing-rolling-upgrades-of-cloud-applications-using-sql-database-active-geo-replication"></a>SQL Database 활성 지역 복제를 사용하여 클라우드 응용 프로그램의 롤링 업그레이드 관리
> [!NOTE]
> [활성 지역 복제](sql-database-geo-replication-overview.md)는 현재 모든 계층의 모든 데이터베이스에 대해 제공됩니다.
> 

SQL Database에서 [지역에서 복제](sql-database-geo-replication-overview.md)를 사용하여 클라우드 응용 프로그램의 롤링 업그레이드를 사용하도록 설정하는 방법을 알아봅니다. 업그레이드는 중단 작업이기 때문에 무중단 업무 방식 계획 및 디자인의 일부여야 합니다. 이 문서에서는 업그레이드 프로세스를 오케스트레이션하는 두 가지 다른 방법을 살펴보고 각 옵션의 이점 및 장단점을 설명합니다. 이 문서의 목적에 맞게 해당 데이터 계층으로 단일 데이터베이스에 연결된 웹 사이트로 구성된 간단한 응용 프로그램을 사용합니다. 최종 사용자 환경에 많은 영향을 주지 않고 응용 프로그램의 버전 1을 버전 2로 업그레이드하는 것이 목표입니다. 

업그레이드 옵션을 평가할 때 다음과 같은 요소를 고려해야 합니다.

* 업그레이드 중에 응용 프로그램 가용성에 미치는 영향 응용 프로그램의 기능이 제한되거나 저하될 수 있는 기간
* 업그레이드 오류가 발생할 경우 롤백할 수 있는 기능
* 업그레이드 중에 관련 없는 치명적인 오류가 발생하는 경우 응용 프로그램의 취약성
* 총 달러 비용.  여기에는 업그레이드 프로세스에서 사용되는 임시 구성 요소의 추가 중복 및 증분 비용이 포함됩니다. 

## <a name="upgrading-applications-that-rely-on-database-backups-for-disaster-recovery"></a>재해 복구에 대해 데이터베이스 백업을 사용하는 응용 프로그램 업그레이드
응용 프로그램이 재해 복구에 대해 자동 데이터베이스 백업을 사용하고 지역 복원을 사용하는 경우 일반적으로 단일 Azure 지역에 배포됩니다. 이 경우 업그레이드 프로세스에는 업그레이드에 포함된 모든 응용 프로그램 구성 요소의 백업 배포를 만드는 것이 포함됩니다. 최종 사용자 중단을 최소화하려면 장애 조치(failover) 프로필에 Azure Traffic Manager(WATM)를 활용합니다.  다음 다이어그램에서는 업그레이드 프로세스 전의 운영 환경을 보여 줍니다. <i>contoso-1.azurewebsites.net</i> 끝점은 업그레이드해야 하는 응용 프로그램의 프로덕션 슬롯을 나타냅니다. 업그레이드를 롤백할 수 있는 기능을 사용하려면 응용 프로그램의 완전히 동기화된 복사본으로 스테이지 슬롯을 만들어야 합니다. 다음 단계는 업그레이드에 대해 응용 프로그램을 준비하는 데 필요합니다.

1. 업그레이드에 대한 스테이지 슬롯을 만듭니다. 이를 수행하려면 보조 데이터베이스(1)를 만들고 동일한 Azure 지역에서 동일한 웹 사이트를 배포합니다. 보조 데이터베이스를 모니터링하여 시딩 프로세스가 완료되었는지 확인합니다.
2. <i>contoso-1.azurewebsites.net</i>을 온라인 끝점으로 하고 <i>contoso-2.azurewebsites.net</i>을 오프라인으로 하여 WATM에서 장애 조치(failover) 프로필을 만듭니다. 

> [!NOTE]
> 준비 단계는 프로덕션 슬롯의 응용 프로그램에 영향을 주지 않으며 모든 권한 모드에서 작동할 수 있습니다.
>  

![SQL Database 지역에서 복제 구성 클라우드 재해 복구](media/sql-database-manage-application-rolling-upgrade/Option1-1.png)

준비 단계가 완료되면 응용 프로그램이 실제 업그레이드할 준비가 된 것입니다. 다음 다이어그램에서는 업그레이드 프로세스에 관련된 단계를 보여 줍니다. 

1. 프로덕션 슬롯의 주 데이터베이스를 읽기 전용 모드로 설정합니다(3). 이렇게 하면 응용 프로그램(V1)의 생산 인스턴스가 업그레이드 중에 읽기 전용으로 유지되어 V1 및 V2 데이터베이스 인스턴스 간의 데이터 확산을 방지할 수 있습니다.  
2. 계획된 종료 모드를 사용하여 보조 데이터베이스의 연결을 끊습니다(4). 이렇게 하면 주 데이터베이스의 완전히 동기화된 독립 복사본이 만들어집니다. 이 데이터베이스가 업그레이드됩니다.
3. 주 데이터베이스를 읽기-쓰기 모드로 설정하고 스테이지 슬롯에서 업그레이드 스크립트를 실행합니다(5).     

![SQL Database 지역에서 복제 구성 클라우드 재해 복구](media/sql-database-manage-application-rolling-upgrade/Option1-2.png)

업그레이드가 완료되면 이제 최종 사용자를 응용 프로그램의 준비된 복사본으로 전환할 준비가 된 것입니다. 이제 응용 프로그램의 프로덕션 슬롯이 됩니다.  여기에 다음 다이어그램에 설명된 것과 같이 몇 가지 추가 단계가 포함됩니다.

1. WATM 프로필의 온라인 끝점을 V2 버전의 웹 사이트를 가리키는 <i>contoso-2.azurewebsites.net</i>으로 전환합니다(6). 이제 V2 응용 프로그램이 포함된 프로덕션 슬롯이 되며 최종 사용자 트래픽이 여기로 이동됩니다.  
2. 더 이상 V1 응용 프로그램 구성 요소가 필요하지 않은 경우 안전하게 제거할 수 있습니다(7).   

![SQL Database 지역에서 복제 구성 클라우드 재해 복구](media/sql-database-manage-application-rolling-upgrade/Option1-3.png)

예를 들어 업그레이드 스크립트의 오류로 인해 업그레이드 프로세스가 실패할 경우 스테이지 슬롯은 손상된 것으로 간주해야 합니다. 응용 프로그램을 업그레이드 전 상태로 롤백하려면 프로덕션 슬롯의 응용 프로그램을 모든 권한으로 되돌리면 됩니다. 다음 다이어그램에 관련된 단계가 표시되어 있습니다.    

1. 데이터베이스 복사본을 읽기-쓰기 모드로 설정합니다(8). 이렇게 하면 프로덕션 슬롯에서 전체 V1을 기능적으로 복원하게 됩니다.
2. 근본 원인 분석을 수행하고 스테이지 슬롯의 손상된 구성 요소를 제거합니다(9). 

이 시점에서 응용 프로그램은 완벽하게 작동하며 업그레이드 단계는 반복할 수 있습니다.

> [!NOTE]
> 롤백은 이미 <i>contoso-1.azurewebsites.net</i>을 활성 끝점으로 가리키고 있으므로 WATM 프로필의 변경이 필요하지 않습니다.
> 
> 

![SQL Database 지역에서 복제 구성 클라우드 재해 복구](media/sql-database-manage-application-rolling-upgrade/Option1-4.png)

이 옵션의 핵심 **이점**은 일련의 간단한 단계를 사용하여 단일 지역의 응용 프로그램을 업그레이드할 수 있다는 것입니다. 업그레이드의 달러 비용은 상대적으로 낮습니다. 주 **단점** 은 업그레이드 중에 치명적인 오류가 발생하는 경우 업그레이드 전 상태로의 복구에 다른 지역에서 응용 프로그램을 다시 배포하고 지역 복원을 사용하여 백업에서 데이터베이스를 복원하는 것이 포함된다는 것입니다. 이 프로세스를 통해 상당한 가동 중지 시간이 발생합니다.   

## <a name="upgrading-applications-that-rely-on-database-geo-replication-for-disaster-recovery"></a>재해 복구에 대해 데이터베이스 지역에서 복제를 사용하는 응용 프로그램 업그레이드
응용 프로그램이 무중단 업무 방식을 위해 지역에서 복제를 활용하는 경우 주 지역에서 활성 배포를 사용하고 Backup 지역에서 대기 배포를 사용하여 두 개 이상의 다른 지역에 배포됩니다. 앞에서 언급한 요인 외에도 업그레이드 프로세스는 다음을 보장해야 합니다.

* 응용 프로그램이 업그레이드 프로세스 중에 치명적인 오류로부터 항상 보호된 상태로 유지됨
* 응용 프로그램의 지역 중복 구성 요소가 활성화된 구성 요소와 함께 병렬로 업그레이드됨

이러한 목표를 달성하기 위해 하나의 활성 및 세 개의 백업 끝점과 함께 장애 조치(failover) 프로필을 사용하여 Azure Traffic Manager(WATM)를 활용하게 됩니다.  다음 다이어그램에서는 업그레이드 프로세스 전의 운영 환경을 보여 줍니다. <i>contoso-1.azurewebsites.net</i> 및 <i>contoso-dr.azurewebsites.net</i> 웹 사이트는 전체 지역 중복이 포함된 응용 프로그램의 프로덕션 슬롯을 나타냅니다. 업그레이드를 롤백할 수 있는 기능을 사용하려면 응용 프로그램의 완전히 동기화된 복사본으로 스테이지 슬롯을 만들어야 합니다. 업그레이드 프로세스 중에 치명적인 오류가 발생할 경우 응용 프로그램이 빠르게 복구될 수 있음을 보장해야 하기 때문에 스테이지 슬롯도 지역 중복이어야 합니다. 다음 단계는 업그레이드에 대해 응용 프로그램을 준비하는 데 필요합니다.

1. 업그레이드에 대한 스테이지 슬롯을 만듭니다. 이를 수행하려면 보조 데이터베이스(1)를 만들고 동일한 Azure 지역에서 웹 사이트의 동일한 복사본을 배포합니다. 보조 데이터베이스를 모니터링하여 시딩 프로세스가 완료되었는지 확인합니다.
2. 보조 데이터베이스를 백업 지역에 지역 복제하여 스테이지 슬롯에서 지역 중복 보조 데이터베이스를 만듭니다("연결된 지역에서 복제"라고 함). 백업 보조 데이터베이스를 모니터링하여 시딩 프로세스가 완료되었는지 확인합니다(3).
3. 백업 지역에 웹 사이트의 대기 복사본을 만들고 지역 중복 보조 데이터베이스에 연결합니다(4).  
4. <i>contoso-2.azurewebsites.net</i> 및 <i>contoso-3.azurewebsites.net</i> 추가 끝점을 WATM의 장애 조치(failover) 프로필에 오프라인 끝점으로 추가합니다(5). 

> [!NOTE]
> 준비 단계는 프로덕션 슬롯의 응용 프로그램에 영향을 주지 않으며 모든 권한 모드에서 작동할 수 있습니다.
> 
> 

![SQL Database 지역에서 복제 구성 클라우드 재해 복구](media/sql-database-manage-application-rolling-upgrade/Option2-1.png)

준비 단계가 완료되면 스테이지 슬롯이 업그레이드할 준비가 된 것입니다. 다음 다이어그램에서는 업그레이드 단계를 보여 줍니다.

1. 프로덕션 슬롯의 주 데이터베이스를 읽기 전용 모드로 설정합니다(6). 이렇게 하면 응용 프로그램(V1)의 생산 인스턴스가 업그레이드 중에 읽기 전용으로 유지되어 V1 및 V2 데이터베이스 인스턴스 간의 데이터 확산을 방지할 수 있습니다.  
2. 계획된 종료 모드를 사용하여 동일한 지역의 보조 데이터베이스의 연결을 끊습니다(7). 이렇게 하면 주 데이터베이스의 완전히 동기화된 독립 복사본이 만들어지고 이는 종료 후 자동으로 주 데이터베이스가 됩니다. 이 데이터베이스가 업그레이드됩니다.
3. 스테이지 슬롯의 주 데이터베이스를 읽기-쓰기 모드로 설정하고 업그레이드 스크립트를 실행합니다(8).    

![SQL Database 지역에서 복제 구성 클라우드 재해 복구](media/sql-database-manage-application-rolling-upgrade/Option2-2.png)

업그레이드가 완료되면 이제 최종 사용자를 응용 프로그램의 V2 버전으로 전환할 준비가 된 것입니다. 다음 다이어그램은 관련 단계를 보여 줍니다.

1. WATM 프로필의 활성 끝점을 이제 V2 버전의 웹 사이트를 가리키는 <i>contoso-2.azurewebsites.net</i>으로 전환합니다(9). 이제 V2 응용 프로그램이 포함된 프로덕션 슬롯이 되며 최종 사용자 트래픽이 여기로 이동됩니다. 
2. 더 이상 V1 응용 프로그램이 필요하지 않은 경우 안전하게 제거할 수 있습니다(10, 11).  

![SQL Database 지역에서 복제 구성 클라우드 재해 복구](media/sql-database-manage-application-rolling-upgrade/Option2-3.png)

예를 들어 업그레이드 스크립트의 오류로 인해 업그레이드 프로세스가 실패할 경우 스테이지 슬롯은 손상된 것으로 간주해야 합니다. 응용 프로그램을 업그레이드 전 상태로 롤백하려면 프로덕션 슬롯의 모든 권한이 있는 응용 프로그램을 사용하도록 되돌리면 됩니다. 다음 다이어그램에 관련된 단계가 표시되어 있습니다.    

1. 프로덕션 슬롯의 주 데이터베이스 복사본을 읽기-쓰기 모드로 설정합니다(12). 이렇게 하면 프로덕션 슬롯에서 전체 V1을 기능적으로 복원하게 됩니다.
2. 근본 원인 분석을 수행하고 스테이지 슬롯의 손상된 구성 요소를 제거합니다(13, 14). 

이 시점에서 응용 프로그램은 완벽하게 작동하며 업그레이드 단계는 반복할 수 있습니다.

> [!NOTE]
> 롤백은 이미 <i>contoso-1.azurewebsites.net</i>을 활성 끝점으로 가리키고 있으므로 WATM 프로필의 변경이 필요하지 않습니다.
> 
> 

![SQL Database 지역에서 복제 구성 클라우드 재해 복구](media/sql-database-manage-application-rolling-upgrade/Option2-4.png)

이 옵션의 핵심 **이점** 은 업그레이드하는 동안 무중단 업무 방식을 손상시키지 않고 응용 프로그램 및 해당 지역 중복 복사본 모두를 병렬로 업그레이드할 수 있다는 것입니다. 주 **단점** 은 각 응용 프로그램 구성 요소의 이중 중복이 필요하므로 더 높은 달러 비용이 발생한다는 것입니다. 또한 더 복잡한 워크플로가 사용됩니다. 

## <a name="summary"></a>요약
문서에서 설명된 두 개의 업그레이드 방법은 복잡성과 달러 비용에서 차이가 있지만 둘 다 최종 사용자가 읽기 전용 작업으로 제한될 때 시간을 최소화하는 데 집중합니다. 해당 시간은 업그레이드 스크립트의 기간으로 직접 정의됩니다. 데이터베이스 크기, 선택한 서비스 계층, 웹 사이트 구성 및 쉽게 제어할 수 없는 기타 요인에 따라 달라지지 않습니다. 이는 모든 준비 단계가 업그레이드 단계에서 분리되고 프로덕션 응용 프로그램에 영향을 주지 않고 수행될 수 있기 때문입니다. 업그레이드 스크립트의 효율성은 업그레이드하는 동안 최종 사용자 환경을 결정하는 핵심 요소입니다. 따라서 사용자 환경을 개선하는 가장 좋은 방법은 업그레이드 스크립트를 가능한 한 효율적으로 만드는 데 집중하는 것입니다.  

## <a name="next-steps"></a>다음 단계
* 비즈니스 연속성의 개요 및 시나리오를 보려면 [비즈니스 연속성 개요](sql-database-business-continuity.md)를 참조하세요.
* Azure SQL Database 자동화 백업에 대한 자세한 내용은 [SQL Database 자동화 백업](sql-database-automated-backups.md)을 참조하세요.
* 복구를 위해 자동화된 백업을 사용하는 방법을 알아보려면 [자동화된 백업에서 데이터베이스 복원](sql-database-recovery-using-backups.md)을 참조하세요.
* 빠른 복구 옵션에 대해 알아보려면 [활성 지역 복제](sql-database-geo-replication-overview.md)를 참조하세요.


