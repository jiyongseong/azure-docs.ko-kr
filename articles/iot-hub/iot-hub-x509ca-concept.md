---
title: "Azure IoT Hub X.509 보안의 개념 | Microsoft Docs"
description: "개념 - IoT 장치 제조 및 인증에서 X.509 인증 기관 인증서의 가치를 이해합니다."
services: iot-hub
documentationcenter: .net
author: eustacea
manager: arjmands
editor: 
ms.assetid: 
ms.service: iot-hub
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/18/2017
ms.author: eustacea
ms.openlocfilehash: 34d4be431b76d5ba8258d932cb21ed6f4818863e
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 10/11/2017
---
# <a name="conceptual-understanding-of-x509-ca-certificates-in-the-iot-industry"></a>IoT 업계의 X.509 CA 인증서에 대한 개념적 이해

이 문서는 IoT 장치 제조 및 IoT Hub 인증에 X.509 CA(인증 기관) 인증서를 사용하는 가치에 대해 설명합니다.  여기에는 공급망 설정 및 주요 이점에 대한 정보가 포함됩니다.

이 문서에서는 다음을 설명합니다.

* X.509 CA 인증서에 대한 정의 및 확보 방법
* IoT Hub에 X.509 CA 인증서를 등록하는 방법
* X.509 CA 기반 인증서의 제조 공급망을 설정하는 방법
* X.509 CA로 서명한 장치를 IoT Hub에 연결하는 방법

## <a name="overview"></a>개요

X.509 CA(인증 기관)는 공급망에서 ID 생성 및 수명 주기 관리를 대폭 간소화하는 방법을 사용하여 IoT Hub에 장치를 인증하는 접근 방식입니다.

X.509 CA 인증의 특징은 CA 인증서가 다운스트림 장치와 일 대 다 관계를 유지하는 것입니다.  이러한 관계로 인해 X.509 CA 인증서를 한 번 등록하면 IoT Hub에 여러 장치를 등록할 수 있습니다. 그렇지 않으면 장치를 연결하기 전에 모든 장치에 장치 고유의 인증서를 미리 등록해야 합니다. 이 일 대 다 관계는 장치 인증서 수명 주기 관리 작업을 간소화하기도 합니다.

X.509 CA 인증의 또 다른 중요한 특성은 공급망 물류의 간소화입니다.  장치의 안전한 인증을 위해서는 신뢰를 위한 기반으로 각 장치에 고유한 비밀(예: 키)을 유지해야 합니다. 인증서 기반 인증에서 이 비밀은 개인 키입니다. 일반적인 장치 제조 흐름에는 여러 단계와 보유자가 필요합니다.  여러 보유자의 장치 개인 키를 안전하게 관리하고 신뢰를 유지하는 것은 어렵고 비용이 많이 듭니다.  인증 기관을 사용하면 장치 관리자 개인 키에 위임하는 대신 각 보유자와 신뢰할 수 있는 암호화 체인을 체결하여 이 문제를 해결할 수 있습니다.  각 보유자는 차례대로 제조 흐름의 각 프로세스 단계에서 장치에 서명합니다.  전반적인 결과물은 신뢰할 수 있는 암호화 체인을 사용하며 책임 소재가 내장된 최적의 공급망입니다.  이 프로세스에서 장치가 자체 개인 키를 보호할 때 가장 안전한 보안을 제공한다는 점은 주목할 만 합니다.  이를 위해 내부적으로 개인 키(절대 공개되지 않는)를 생성할 수 있는 HSM(Hardware Secure Modules)을 사용할 것을 권장합니다.

이 문서는 X.509 CA 인증 사용에 대해 공급망 설정에서 장치 연결에 이르는 포괄적인 관점을 제공하면서 이해를 확고히 하기 위한 실제 사례를 활용합니다.

## <a name="introduction"></a>소개

X.509 CA 인증서는 보유자가 다른 인증서에 서명할 수 있는 디지털 인증서입니다.  이 디지털 인증서는 IETF의 RFC 5280 표준에 규정된 인증서 형식 표준을 준수하기 때문에 X.509이고 보유자가 다른 인증서에 서명할 수 있기 대문에 CA(인증 기관)입니다.

X.509 CA 사용은 구체적인 예와 관련될 때 가장 이해하기 쉽습니다.  전문 설치용으로 설계된 Smart-X-Widgets의 메이커인 Company-X의 경우를 살펴보겠습니다. Company-X는 제조와 설치를 모두 아웃소싱합니다.  Smart-X-Widget을 제조하기 위해 Factory-Y라는 제조업체와 계약을 체결하고 설치를 위해 Technician-Z라는 서비스 공급자와 계약을 체결합니다. Company-X는 Smart-X-Widget이 설치를 위해 Factory-Y에서 Technician-Z로 직접 배송되고 설치 후 Company-X의 추가 개입 없이 Company-X의 IoT Hub 인스턴스에 직접 연결되기를 바랍니다. 이를 위해 Company-X는 자동 연결을 위해 주요 Smart-X-Widget에 대한 몇 가지 일회성 설정 작업을 완료해야 합니다.  포괄적인 시나리오를 고려하여 이 문서의 나머지 부분은 다음과 같이 구성됩니다.

* X.509 CA 인증서 취득

* IoT Hub에 X.509 CA 인증서 등록

* 신뢰할 수 있는 인증서 체인에 장치 서명

* 장치 연결

## <a name="acquire-the-x509-ca-certificate"></a>X.509 CA 인증서 취득

Company-X는 공용 루트 인증 기관에서 X.509 CA 인증서를 구입하거나 자체 서명된 프로세스를 통해 인증서를 생성할 수 있는 옵션이 있습니다.  응용 프로그램 시나리오에 따라 한 가지 옵션이 다른 옵션보다 적합할 수 있습니다.  옵션에 관계없이 프로세스에는 공개/개인 키 쌍을 생성하고 공개 키를 인증서에 서명하는 두 가지 기본 단계가 수반됩니다.

![img-csr-flow](./media/csr-flow.png)

이러한 단계를 수행하는 방법에 대한 자세한 내용은 서비스 공급자마다 다릅니다.

### <a name="purchasing-an-x509-ca-certificate"></a>X.509 CA 인증서 구입

CA 인증서를 구입하면 장치가 연결될 때 잘 알려진 루트 CA를 신뢰할 수 있는 타사로 사용하여 IoT 장치의 적법성을 보증할 수 있다는 장점이 있습니다. IoT Hub에 처음 연결한 후 Smart-X-Widget이 타사 제품 또는 서비스와 상호 작용해야 하는 경우 Company-X는 이 옵션을 선택합니다.

X.509 CA 인증서를 구입하기 위해 Company-X는 루트 인증서 서비스 공급자를 선택합니다. '루트 CA'라는 문구를 인터넷으로 검색하면 좋은 단서를 얻을 수 있습니다.  루트 CA는 Company-X에 공개/개인 키 쌍을 만드는 방법과 서비스에 대한 CSR(인증서 서명 요청)을 생성하는 방법을 안내합니다.  CSR은 인증 기관의 인증서를 신청하는 공식적인 프로세스입니다.  이러한 구입의 결과물은 기관 인증서로 사용하기 위한 인증서입니다.  X.509 인증서의 보편성을 감안할 때 이 인증서는 IETF의 RFC 5280 표준에 맞는 올바른 형식을 갖추었을 가능성이 높습니다.

### <a name="creating-a-self-signed-x509-ca-certificate"></a>자체 서명된 X.509 CA 인증서 만들기

자체 서명된 X.509 CA 인증서를 만드는 프로세스는 루트 인증 기관과 같은 타사 서명자를 필요로 하는 것을 제외하면 구입 프로세스와 유사합니다. 이 예제에서 Company-X는 루트 인증 기관 대신 자체 기관 인증서에 서명합니다.  Company-X는 기관 인증서를 구입할 준비가 될 때까지 이 옵션을 테스트용으로 선택할 수 있습니다. Smart-X-Widget이 IoT Hub 외부의 타사 서비스에 연결할 필요가 없는 경우 Company-X는 프로덕션 환경에서 자체 서명된 X.509 CA 인증서를 사용할 수도 있습니다.

## <a name="register-the-x509-certificate-to-iot-hub"></a>IoT Hub에 X.509 인증서 등록

Company-X는 Smart-X-Widget을 연결할 때 인증을 수행하는 IoT Hub에 X.509 CA를 등록해야 합니다.  이것은 Smart-X-Widget 장치를 원하는 수 만큼 인증하고 관리할 수 있도록 하는 일회성 프로세스입니다.  이 프로세스는 기관 인증서와 장치 간의 일 대 다 관계로 인해 일회성이며 X.509 CA 인증 방법을 사용하는 주요 장점 중 하나이기도 합니다.  이렇게 하지 않고 각각의 Smart-X-Widget 장치마다 개별 인증서 지문을 업로드하면 운영 비용이 추가됩니다.

X.509 CA 인증서 등록에는 인증서 업로드 및 인증서 소유 증명이라는 2단계 프로세스가 있습니다.

![img-pop-flow](./media/pop-flow.png)

### <a name="x509-ca-certificate-upload"></a>X.509 CA 인증서 업로드

X.509 CA 인증서 업로드 프로세스는 CA 인증서를 IoT Hub에 업로드하는 것입니다.  IoT Hub에는 인증서를 파일로 제공해야 합니다. Company-X는 인증서 파일을 업로드하기만 하면 됩니다. 인증서 파일에는 어떠한 경우에도 개인 키가 포함되지 말아야 합니다.  PKI(공개 키 인프라)를 관리하는 표준의 모범 사례에 따르면 이 경우 Company-X의 개인 정보가 Company-X 내에만 상주해야 합니다.

### <a name="proof-of-possession-of-the-certificate"></a>인증서의 소유 증명

X.509 CA 인증서는 디지털 인증서와 마찬가지로 도청의 위험이 있는 공개 정보입니다.  따라서 도청자가 인증서를 가로채서 인증서를 자신의 것으로 업로드하려고 시도할 수 있습니다.  이 예에서 IoT Hub는 Company-X가 업로드하는 CA 인증서가 Company-X에 실제 속하는지 확인하려고 합니다. 이를 위해 [PoP(소유 증명) 흐름](https://tools.ietf.org/html/rfc5280#section-3.1)을 통해서 Company-X가 인증서를 실제로 소유한다는 것을 증명하도록 Company-X에 요구합니다. 소유 증명 흐름에는 IoT Hub에서 Company-X가 자체 개인 키를 사용하여 서명할 난수를 생성하는 단계가 수반됩니다.  Company-X가 PKI 모범 사례에 따라 개인 키를 보호한 경우 소유 증명 챌린지에 올바르게 응답할 수 있는 상태가 됩니다.  소유 증명 챌린지에 대한 응답이 성공하면 IoT Hub는 X.509 CA 인증서 등록을 진행합니다.

IoT Hub의 소유 증명 챌린지에 대한 응답이 성공하면 X.509 CA 등록이 완료됩니다.

## <a name="sign-devices-into-a-certificate-chain-of-trust"></a>신뢰할 수 있는 인증서 체인에 장치 서명

IoT에서는 모든 장치가 고유 ID를 소유해야 합니다.  이러한 ID는 인증서 기반 인증 체계에 대한 양식 인증서 형식입니다.  이 예제에서는 모든 Smart-X-Widget이 고유한 장치 인증서를 소유해야 합니다.  Company-X가 자체 공급망에 이것을 어떻게 설정할까요?

이것을 해결하는 한 가지 방법은 Smart-X-Widget용 인증서를 미리 생성하고 해당 고유 장치 개인 키에 대한 정보를 공급망 파트너에게 위임하는 것입니다.  Company-X의 경우 Factory-Y와 Technician-Z에게 위임합니다.  이것은 유효한 방법이지만 신뢰를 확보하기 위해 극복해야 할 다음과 같은 과제가 있습니다.

1. 개인 키를 절대 공유하지 않는 PKI 모범 사례를 무시하는 것 외에 장치 개인 키를 공급망 파트너와 공유해야 하므로 공급망에 대한 신뢰를 구축하는 비용이 높아집니다.  즉 장치 개인 키를 수용할 안전한 공간과 같은 주된 시스템과 주기적인 보안 감사와 같은 프로세스를 설치해야 합니다.  둘 다 공급망에 비용을 추가합니다.

2. 장치를 공급망에서 안전하게 책임지고 나중에 배포 시 관리하는 것은 장치 고유 인증서(개인 키) 생성부터 장치 폐기까지 모든 키-장치 쌍에 대해 일대일 작업이 됩니다. 이런 경우 그룹 개념이 프로세스에 명시적으로 내장되어 있지 않는 한 장치의 그룹 관리가 불가능합니다. 따라서 보안 프로세스 및 장치 수명 주기 관리는 운영에 큰 부담이 됩니다.  이 예에서 Company-X는 이러한 부담을 감당합니다.

X.509 CA 인증서 인증은 인증서 체인을 사용하여 위에서 언급한 문제에 대한 명확한 솔루션을 제공합니다.  인증서 체인은 중간 CA에 서명하는 CA로부터 발생하는데 이 CA는 다른 중간 CA에 서명하고 결국 마지막 중간 CA가 장치에 서명할 때까지 서명이 계속됩니다.  이 예에서 Company-X는 Factory-Y에 서명하고 다음으로 Factory-Y가 Technician-Z에 서명하고 마지막으로 Smart-X-Widget에 서명합니다.

![img-cert-chain-hierarchy](./media/cert-chain-hierarchy.png)

위의 체인에 있는 인증서 캐스케이드는 권한의 논리적인 전달을 나타냅니다.  많은 공급망에서 논리적인 전달을 수행하며 각각의 중간 CA는 모든 업스트림 CA 인증서를 받는 동안 체인에 서명하고 마지막 중간 CA가 최종적으로 각 장치에 서명하고 체인의 모든 기관 인증서를 장치에 삽입합니다. 이 방식은 팩터리 계층 구조가 있는 계약 제조 회사가 특정 팩터리에 제조를 수행하도록 위임하는 경우 일반적으로 사용됩니다.  계층 구조의 깊이에는 여러 수준이 있을 수 있지만(예: 지리/제품 유형/제조 라인별) 마지막 팩터리만 장치와 상호 작용하고 체인은 계층 구조의 맨 위에서 유지됩니다.

대체 체인에는 장치와 상호 작용하는 다른 중간 CA가 있을 수 있으며 이런 경우 장치와 상호 작용하는 CA가 해당 시점에서 인증서 체인 콘텐츠를 삽입합니다.  하이브리드 모델도 가능한데 이런 경우 일부 CA만 장치와 물리적으로 상호 작용합니다.

이 예제에서는 Factory-Y와 Technician-Z가 Smart-X-Widget과 상호 작용합니다.  Company-X는 Smart-X-Widget을 소유하고 있지만 실제로는 전체 공급망에서 물리적으로 상호 작용하지 않습니다.  따라서 Smart-X-Widget의 신뢰할 수 있는 인증서 체인에서는 Company-X가 Factory-Y에 서명하고 Factory-Y가 Technician-Z에 서명하면 Smart-X-Widget에 최종 서명이 제공됩니다. Smart-X-Widget 제조 및 설치는 각각의 중간 CA 인증서를 사용하여 모든 Smart-X-Widget에 서명하는 Factory-Y 및 Technician-Z로 구성됩니다. 이러한 전체 프로세스의 최종 결과는 고유한 장치 인증서 및 Company-X CA 인증서까지 거슬러 올라가는 신뢰할 수 있는 인증서 체인이 있는 Smart-X-Widget입니다.

![img-cert-mfr-chain](./media/cert-mfr-chain.png)

X.509 CA 메서드의 가치를 검토하는 것이 좋습니다.  Company-X는 공급망에 모든 Smart-X-Widget에 대한 인증서를 미리 생성하고 전달하는 대신 Factory-Y에 한 번만 서명합니다.  장치 수명 주기 전반에 걸쳐 모든 장치를 추적하는 대신 Company-X는 공급망 프로세스에서 자연스럽게 드러나는 그룹(예: 7월 이후 Technician-Z가 설치한 장치)을 통해 장치를 추적하고 관리하지 않을 수 있습니다.

마지막으로 CA 인증 방법은 장치 제조 공급망에 보안 책임성을 부여합니다. 인증서 체인 프로세스로 인해 체인의 모든 구성원의 작업이 암호화되어 기록되고 검증됩니다.

이 프로세스는 완성을 위해 드러나야 하는 특정 가정에 의존합니다.  장치 고유의 공개/개인 키 쌍을 독립적으로 만들어야 하며 장치 내에서 개인 키가 보호되어야 합니다.  다행히도 내부적으로 키를 생성하고 개인 키를 보호할 수 있는 HSM(Hardware Secure Module) 형태의 보안 실리콘 칩이 존재합니다.  Company-X는 Smart-X-Widget의 구성 요소 BOM(부품 자재)에 이러한 칩 중 하나를 추가하기만 하면 됩니다.

## <a name="device-connection"></a>장치 연결

위의 이전 섹션에서는 장치 연결을 구축했습니다.  IoT Hub에 X.509 CA 인증서를 한 번 등록하는 것만으로 어떻게 수백만 대의 장치가 연결되고 처음부터 인증을 받을 수 있을까요?  간단합니다. X.509 CA 인증서를 등록할 때와 마찬가지로 동일한 인증서 업로드와 소유 증명 흐름을 거칩니다.

X.509 CA 인증용으로 제조된 장치에는 장치 고유의 인증서 및 각 제조 공급망의 인증서 체인이 있습니다.  장치 연결은, 처음으로 연결하는 경우라도, 인증서 체인 업로드 및 소유 증명이라는 2단계 프로세스로 이루어집니다.

인증서 체인을 업로드하는 동안 장치는 장치 고유의 인증서를 내부에 설치된 인증서 체인과 함께 IoT 허브에 업로드합니다.  IoT Hub는 미리 등록된 X.509 CA 인증서를 사용하여 업로드된 인증서 체인이 내부적으로 일관되며 해당 체인을 X.509 CA 인증서의 유효한 소유자가 생성했는지를 암호 기법으로 검증할 수 있습니다.  IoT Hub는 X.509 CA 등록 프로세스만으로 소유 증명 챌린지-응답 프로세스를 시작하여 체인 및 장치 인증서가 이것을 업로드한 장치에 실제로 속하는지를 규명합니다.  IoT Hub의 검증을 위해 개인 키를 사용하여 장치에서 서명할 임의 챌린지를 생성하여 이를 수행합니다.   응답이 성공하면 IoT Hub가 장치를 인증된 것으로 받아 들이고 연결을 허용하도록 트리거합니다.

이 예제에서 각 Smart-X-Widget은 장치 고유의 인증서를 Factory-Y 및 Technician-Z X.509 CA 인증서와 함께 업로드한 다음 IoT Hub의 소유 증명 챌린지에 응답합니다.

![img-device-pop-flow](./media/device-pop-flow.png)

신뢰의 기반은 장치 개인 키를 비롯한 개인 키를 보호한다는 점에 있습니다.  따라서 장치 개인 키 보안에 대한 HSM(Hardware Secure Modules) 형태의 보안 실리콘 칩의 중요성을 아무리 강조해도 지나치지 않으며 하나의 팩터리가 다른 팩터리에 개인 키를 위임하는 것과 같이 개인 키를 절대 공유하지 않는 것이 좋습니다.

